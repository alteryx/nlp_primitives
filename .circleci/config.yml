version: 2.1

executors:
  python:
    parameters:
      image_tag:
        type: string
        default: "python:3.7"
    docker:
      - image: circleci/<< parameters.image_tag >>

commands:
  installation:
    steps:
      - checkout
      - run:
          name: "Install Package in Virtual Environment"
          command: |
            virtualenv env -q
            source env/bin/activate
            pip install . -q

jobs:
  lint_tests:
    working_directory: ~/nlp_primitives
    parameters:
      image_tag:
        type: string
        default: "python:3.7"
    executor:
      name: python
      image_tag: << parameters.image_tag >>
    steps:
      - installation
      - run:
          name: "Install Test Requirements"
          command: |
            source env/bin/activate
            pip install -r test-requirements.txt -q
      - run:
          name: "Run Lint Tests"
          command: |
            source env/bin/activate
            make lint-tests


  unit_tests:
    working_directory: ~/nlp_primitives
    parameters:
      image_tag:
        type: string
        default: "python:3.7"
    executor:
      name: python
      image_tag: << parameters.image_tag >>
    steps:
      - installation
      - run:
          name: "Install Test Requirements"
          command: |
            source env/bin/activate
            pip install -r test-requirements.txt -q
      - run:
          name: "Run Unit Tests"
          command: |
            source env/bin/activate
            make unit-tests

  entry_point_test:
    working_directory: ~/nlp_primitives
    parameters:
      image_tag:
        type: string
        default: "python:3.7"
    executor:
      name: python
      image_tag: << parameters.image_tag >>
    steps:
      - installation
      - run:
          name: "Test Entry Point"
          command: |
            source env/bin/activate
            python -c "from featuretools import nlp_primitives"

workflows:
  version: 2
  "Integration Tests":